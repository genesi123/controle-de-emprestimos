<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Empréstimos Integrado</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: #f0f2f5; color: #1c1e21; } .container { max-width: 800px; margin: 20px auto; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } h1 { text-align: center; color: #1877f2; } h2.summary-title { text-align: center; margin: 5px 0; font-size: 1.2em; } .form-actions { display: flex; width: 100%; gap: 10px; } form { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; } .form-group { flex: 1 1 200px; } label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; } input[type="text"], input[type="date"], input[type="number"] { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #dddfe2; box-sizing: border-box; } .main-button { flex-grow: 1; padding: 12px; font-size: 16px; font-weight: bold; background-color: #1877f2; color: white; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px; transition: background-color 0.2s; } .main-button:hover:not(:disabled) { background-color: #166fe5; } .main-button:disabled { background-color: #a0bdf1; cursor: not-allowed; } .cancel-button { padding: 12px; font-size: 16px; font-weight: bold; background-color: #f0f2f5; color: #4b4f56; border: 1px solid #dddfe2; border-radius: 6px; cursor: pointer; margin-top: 10px; transition: background-color 0.2s; display: none; } .tab-nav { display: flex; border-bottom: 2px solid #dddfe2; margin-bottom: 20px; } .tab-link { background: none; border: none; padding: 15px 20px; cursor: pointer; font-size: 16px; font-weight: 600; color: #606770; border-bottom: 3px solid transparent; margin-bottom: -2px; } .tab-link.active { color: #1877f2; border-bottom-color: #1877f2; } .tab-content { display: none; } .tab-content.active { display: block; } .emprestimo-item { padding: 15px; margin-bottom: 10px; border-radius: 6px; border-left: 5px solid; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; background-color: #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.05); } .status-pendente { border-left-color: #ffc107; } .status-atrasado { border-left-color: #dc3545; } .status-pago { border-left-color: #28a745; } .botoes-acao { display: flex; gap: 10px; } .btn-acao { padding: 8px 12px; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500; } .btn-pagar { background-color: #28a745; } .btn-editar { background-color: #ffc107; } .btn-apagar { background-color: #dc3545; } .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; } .loader { border: 5px solid #f3f3f3; border-radius: 50%; border-top: 5px solid #3498db; width: 50px; height: 50px; animation: spin 1s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay"><div class="loader"></div></div>
    <div class="container">
        <h1>Controle de Empréstimos</h1>
        <h2 id="total-emprestado" class="summary-title" style="color: #333;"></h2>
        <h2 id="total-a-receber" class="summary-title" style="color: #c79100;"></h2>
        <h2 id="lucro-potencial" class="summary-title" style="color: #1a73e8;"></h2>
        <h2 id="lucro-realizado" class="summary-title" style="color: #1e8e3e; margin-bottom: 25px;"></h2>
        
        <form id="loanForm">
            <input type="hidden" id="loanId"> <div class="form-group"><label for="nome">Nome do Cliente:</label><input type="text" id="nome" required></div>
            <div class="form-group"><label for="credor">Seu Nome (Credor):</label><input type="text" id="credor" required></div>
            <div class="form-group"><label for="valor">Valor Emprestado (R$):</label><input type="number" id="valor" placeholder="1000.00" required></div>
            <div class="form-group"><label for="dataEmprestimo">Data do Empréstimo:</label><input type="date" id="dataEmprestimo" required></div>
            <div class="form-group"><label for="dataPagamento">Data do Pagamento:</label><input type="date" id="dataPagamento" required></div>
            <div class="form-actions">
                <button type="submit" id="mainSubmitButton" class="main-button">Adicionar Empréstimo</button>
                <button type="button" id="cancelEditButton" class="cancel-button" onclick="cancelarEdicao()">Cancelar</button>
            </div>
        </form>
        <hr style="border: none; border-top: 1px solid #dddfe2; margin: 30px 0;">
        <div class="tab-nav">
            <button class="tab-link active" onclick="openTab(event, 'ativos')">Empréstimos Ativos</button>
            <button class="tab-link" onclick="openTab(event, 'pagos')">Histórico de Pagos</button>
        </div>
        <div id="ativos" class="tab-content active"><h2 style="color:#1877f2;">Pendentes e Atrasados</h2><div id="listaAtivos"></div></div>
        <div id="pagos" class="tab-content"><h2 style="color:#1877f2;">Já Pagos</h2><div id="listaPagos"></div></div>
    </div>

    <script>
        // ##################################################################
        // COLE A URL DA SUA API DO GOOGLE APPS SCRIPT AQUI
        const URL_DA_API = "https://script.google.com/macros/s/AKfycbwecawX3egDZw8abZu4VySNJZzXcQlMAjLunEz7Uqa8WUzSLgXea7na1Bu9vNqUYEqTMg/exec";
        // ##################################################################

        let emprestimosAtuais = [];
        const loadingOverlay = document.getElementById('loadingOverlay');
        const mainSubmitButton = document.getElementById('mainSubmitButton');
        const cancelEditButton = document.getElementById('cancelEditButton');
        const loanIdInput = document.getElementById('loanId');
        const loanForm = document.getElementById('loanForm');

        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('ativos').style.display = 'block';
            await buscarEmprestimosDaNuvem();
        });
        
        loanForm.addEventListener('submit', function(event) {
            event.preventDefault();
            salvarDados();
        });

        const showLoading = (show) => { loadingOverlay.style.display = show ? 'flex' : 'none'; };

        async function buscarEmprestimosDaNuvem() {
            showLoading(true);
            try {
                const response = await fetch(URL_DA_API);
                emprestimosAtuais = await response.json();
                renderizarListas();
            } catch (error) {
                console.error("Erro ao buscar dados da nuvem:", error);
                document.getElementById('listaAtivos').innerHTML = '<p style="text-align:center; color: red;">Erro ao carregar os dados. Verifique a URL da API e sua conexão.</p>';
            } finally {
                showLoading(false);
            }
        }

        async function salvarDados() {
            const id = loanIdInput.value;
            if (id) {
                await editarEmprestimo(id);
            } else {
                await adicionarEmprestimo();
            }
        }

        async function adicionarEmprestimo() {
            mainSubmitButton.disabled = true;
            showLoading(true);
            const novoEmprestimo = {
                id: Date.now(),
                nome: document.getElementById('nome').value,
                credor: document.getElementById('credor').value,
                valor: document.getElementById('valor').value,
                dataEmprestimo: document.getElementById('dataEmprestimo').value,
                dataPagamento: document.getElementById('dataPagamento').value,
                status: 'pendente'
            };

            if (!novoEmprestimo.dataEmprestimo || !novoEmprestimo.dataPagamento || !novoEmprestimo.nome || !novoEmprestimo.credor || !novoEmprestimo.valor) {
                alert("Por favor, preencha todos os campos do formulário.");
                mainSubmitButton.disabled = false;
                showLoading(false);
                return;
            }

            try {
                const response = await fetch(URL_DA_API, { method: 'POST', body: JSON.stringify(novoEmprestimo), headers: {'Content-Type': 'application/json'} });
                const result = await response.json();
                if (result.status === "success") {
                    emprestimosAtuais.push(novoEmprestimo);
                    renderizarListas();
                    loanForm.reset();
                } else {
                    alert("A API retornou um erro ao tentar adicionar.");
                }
            } catch (error) {
                console